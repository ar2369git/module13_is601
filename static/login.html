<!DOCTYPE html>
<html>
  <head><meta charset="utfâ€‘8"><title>Login</title></head>
  <body>
    <h1>Login</h1>
    <form id="login-form">
      <input type="text"     name="username_or_email" required placeholder="username or email"/>
      <input type="password" name="password"          required placeholder="password"/>
      <button type="button" id="login">Login</button>
    </form>
    <div id="message"></div>
    <script>
      async function doLogin(){
        const u=document.querySelector("input[name=username_or_email]").value;
        const p=document.querySelector("input[name=password]").value;
        const resp = await fetch("/login", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({username_or_email:u,password:p})
        });
        const body = await resp.json();
        if(resp.ok){
          localStorage.setItem("token", body.token);
          document.getElementById("message").innerText="Logged in!";
        } else {
          document.getElementById("message").innerText=body.error;
        }
      }
      document.getElementById("login").onclick = doLogin;
    </script>
  </body>
</html>
