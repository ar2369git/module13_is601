<!DOCTYPE html>
<html>
  <head><meta charset="utfâ€‘8"><title>Register</title></head>
  <body>
    <h1>Register</h1>
    <form id="register-form">
      <input type="email"    name="email"             required placeholder="email"/>
      <input type="text"     name="username"          required minlength="3" placeholder="username"/>
      <input type="password" name="password"          required minlength="8" placeholder="password"/>
      <input type="password" name="confirm_password"  required minlength="8" placeholder="confirm password"/>
      <button type="button" id="register">Register</button>
    </form>
    <div id="message"></div>
    <script>
      async function doRegister(){
        const e=document.querySelector("input[name=email]").value;
        const u=document.querySelector("input[name=username]").value;
        const p=document.querySelector("input[name=password]").value;
        const c=document.querySelector("input[name=confirm_password]").value;
        if(p!==c){
          return document.getElementById("message").innerText="Passwords must match";
        }
        const resp = await fetch("/register", {
          method:"POST",
          headers:{"Content-Type":"application/json"},
          body: JSON.stringify({username:u,email:e,password:p})
        });
        const body = await resp.json();
        if(resp.ok){
          localStorage.setItem("token", body.token);
          document.getElementById("message").innerText="Registered!";
        } else {
          document.getElementById("message").innerText=body.error;
        }
      }
      document.getElementById("register").onclick = doRegister;
    </script>
  </body>
</html>
